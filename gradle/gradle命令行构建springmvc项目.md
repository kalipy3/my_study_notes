```
gradle构建springmvc项目.md

:Author: kalipy
:Email: kalipy@debian
:Date: 2021-03-02 13:31

```

### gradle创建普通java应用
```
kalipy@debian ~/g/1111> gradle init

Select type of project to generate:
  1: basic
  2: application
  3: library
  4: Gradle plugin
Enter selection (default: basic) [1..4] 2

Select implementation language:
  1: C++
  2: Groovy
  3: Java
  4: Kotlin
  5: Swift
Enter selection (default: Java) [1..5] 3

Select build script DSL:
  1: Groovy
  2: Kotlin
Enter selection (default: Groovy) [1..2] 1

Select test framework:
  1: JUnit 4
  2: TestNG
  3: Spock
  4: JUnit Jupiter
Enter selection (default: JUnit 4) [1..4] 1

Project name (default: 1111): springmvc
Source package (default: springmvc): com.ly

```

### 修改build.gradle

1. 加入war插件，这样可以通过`gradle war`命令快速生成tomcat的war包
    ```
    plugins {
        id 'war'
    }
    ```

2. 修改`repositories`为阿里云maven仓库,这样下载jar包依赖的速度就很快
    ```
    repositories {
        maven { url 'https://maven.aliyun.com/repository/public' }
        maven { url 'https://maven.aliyun.com/repository/central'}
        maven { url 'https://maven.aliyun.com/repository/google'}
        maven { url 'https://maven.aliyun.com/repository/gradle-plugin'}
        maven { url 'https://maven.aliyun.com/repository/spring'}
        maven { url 'https://maven.aliyun.com/repository/spring-plugin'}
        maven { url 'https://maven.aliyun.com/repository/apache-snapshots'}
    
        mavenLocal()
        mavenCentral()
    }
    ```
3. 导入springmvc需要的jar包(如果不知道具体要导入哪些jar包，请自行百度springmvc要导入的jar有哪些)
    ```
    dependencies {
        implementation "javax.servlet.jsp:jsp-api:2.2"
        implementation "javax.servlet:jstl:1.2"
        implementation "javax.servlet:servlet-api:2.5"
        implementation "org.springframework:spring-aop:5.1.9.RELEASE"
        implementation "org.springframework:spring-beans:5.1.9.RELEASE"
        implementation "org.springframework:spring-context:5.1.9.RELEASE"
        implementation "org.springframework:spring-core:5.1.9.RELEASE"
        implementation "org.springframework:spring-expression:5.1.9.RELEASE"
        implementation "org.springframework:spring-jcl:5.1.9.RELEASE"
        implementation "org.springframework:spring-web:5.1.9.RELEASE"
        implementation "org.springframework:spring-webmvc:5.1.9.RELEASE"
        implementation "commons-logging:commons-logging:1.2"
    }
    ```

4. build.gradle最终文件内容如下:
    ```
    /*
     * This file was generated by the Gradle 'init' task.
     *
     * This generated file contains a sample Java project to get you started.
     * For more details take a look at the Java Quickstart chapter in the Gradle
     * User Manual available at https://docs.gradle.org/6.5/userguide/tutorial_java_projects.html
     */
    
    plugins {
        // Apply the java plugin to add support for Java
        id 'java'
    
        // Apply the application plugin to add support for building a CLI application.
        id 'application'
        
        id 'war'
    }
    
    repositories {
        maven { url 'https://maven.aliyun.com/repository/public' }
        maven { url 'https://maven.aliyun.com/repository/central'}
        maven { url 'https://maven.aliyun.com/repository/google'}
        maven { url 'https://maven.aliyun.com/repository/gradle-plugin'}
        maven { url 'https://maven.aliyun.com/repository/spring'}
        maven { url 'https://maven.aliyun.com/repository/spring-plugin'}
        maven { url 'https://maven.aliyun.com/repository/apache-snapshots'}
    
        mavenLocal()
        mavenCentral()
    }
    
    dependencies {
        implementation "javax.servlet.jsp:jsp-api:2.2"
        implementation "javax.servlet:jstl:1.2"
        implementation "javax.servlet:servlet-api:2.5"
        implementation "org.springframework:spring-aop:5.1.9.RELEASE"
        implementation "org.springframework:spring-beans:5.1.9.RELEASE"
        implementation "org.springframework:spring-context:5.1.9.RELEASE"
        implementation "org.springframework:spring-core:5.1.9.RELEASE"
        implementation "org.springframework:spring-expression:5.1.9.RELEASE"
        implementation "org.springframework:spring-jcl:5.1.9.RELEASE"
        implementation "org.springframework:spring-web:5.1.9.RELEASE"
        implementation "org.springframework:spring-webmvc:5.1.9.RELEASE"
        implementation "commons-logging:commons-logging:1.2"
    
        // Use JUnit test framework
        testImplementation 'junit:junit:4.13'
    }
    
    application {
        // Define the main class for the application.
        mainClassName = 'com.ly.App'
    }
    ```

### 编写web.xml
```
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
    version="4.0">

    <!--1.注册servlet-->
    <servlet>
        <servlet-name>SpringMVC</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
            <!--通过初始化参数指定SpringMVC配置文件的位置，进行关联-->
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:springmvc-servlet.xml</param-value>
        </init-param>
        <!-- 启动顺序，数字越小，启动越早 -->
        <load-on-startup>1</load-on-startup>
    </servlet>

    <!--所有请求都会被springmvc拦截 -->
    <servlet-mapping>
        <servlet-name>SpringMVC</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>

</web-app>
```

### 编写springmvc配置文件(springmvc-servlet.xml)
注意:springmvc-servlet.xml和是上面的web.xml通过web.xml的`<param-value>classpath:springmvc-servlet.xml</param-value>`相关联的
```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context
    https://www.springframework.org/schema/context/spring-context.xsd
    http://www.springframework.org/schema/mvc
    https://www.springframework.org/schema/mvc/spring-mvc.xsd">

    <!-- 自动扫描包，让指定包下的注解生效,由IOC容器统一管理  取代IOC配置-->
    <context:component-scan base-package="com.ly.controller"/>

        <!-- 让Spring MVC不处理静态资源 -->
    <mvc:default-servlet-handler />
        <!--
            支持mvc注解驱动
            在spring中一般采用@RequestMapping注解来完成映射关系
            要想使@RequestMapping注解生效
            必须向上下文中注册DefaultAnnotationHandlerMapping
            和一个AnnotationMethodHandlerAdapter实例
            这两个实例分别在类级别和方法级别处理。
            而annotation-driven配置帮助我们自动完成上述两个实例的注入。
            取代了映射器和适配器，使@RequestMapping生效
        -->
    <mvc:annotation-driven />

        <!-- 视图解析器 -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"
        id="internalResourceViewResolver">
        <!-- 前缀 -->
        <property name="prefix" value="/WEB-INF/jsp/" />
            <!-- 后缀 -->
        <property name="suffix" value=".jsp" />
    </bean>

</beans>
```

### 编写控制层的测试代码(HelloController.java)
```
package com.ly.controller;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

import org.springframework.web.bind.annotation.RequestMapping;

/*
 * HelloController.java
 * Copyright (C) 2021 2021-03-02 13:00 kalipy <kalipy@debian>
 *
 * Distributed under terms of the MIT license.
 */

@Controller 
public class HelloController
{
    @RequestMapping("/hello")
    public String hello(Model model) {
        //封装数据，jsp里可以通过${msg}取到这里的msg
        model.addAttribute("msg", "Hello,SpringMCVAnnotation!");
        return "hello";//会被视图解析器处理
    }
}

```

### 编写测试的jsp文件(hello.jsp)
```
<%@ page contentType="text/html;Charset=UTF-8" language="java" %>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
    </head>
    <body>
        ${msg}
    </body>
</html>
```

### 项目各文件位置及目录结构如下:
```
kalipy@debian ~/g/1111> tree src/
src/
├── main
│   ├── java
│   │   └── com
│   │       └── ly
│   │           ├── App.java
│   │           └── controller
│   │               └── HelloController.java
│   ├── resources
│   │   └── springmvc-servlet.xml
│   └── webapp
│       └── WEB-INF
│           ├── jsp
│           │   └── hello.jsp
│           └── web.xml
└── test
    ├── java
    │   └── com
    │       └── ly
    │           └── AppTest.java
    └── resources

```

### 运行gradle war生成war包
```
gradle war
```

### 把war包复制到tomcat的webapps文件夹下
```
cp build/libs/springmvc.war ~/下载/apache-tomcat-9.0.38/webapps/springmvc.war
```

### 测试
1. 启动tomcat

2. 浏览器访问`127.0.0.1:8080/springmvc/hello`(springmvc是war的文件名),浏览器返回结果如下:
    ```
    Hello,SpringMCVAnnotation!
    ```
